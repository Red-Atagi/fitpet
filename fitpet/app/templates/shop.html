<!DOCTYPE html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Pet Clothing Shop</title>
</head>
<style>
.modal {
    display: none; /* hidden by default */
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
}

.modal img {
    max-width: 90%;
    max-height: 90%;
    box-shadow: 0 0 20px #fff;
    border-radius: 8px;
    align-content: center;
}

.modal-content {
  display: flex;
  background-color: white;
  width: 80%;
  max-width: 900px;
  height: 70%;
  border-radius: 8px;
  overflow: hidden;
}

.modal-left, .modal-right {
  flex: 1;
  padding: 20px;
  box-sizing: border-box;
}

.modal-left {
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-left img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

.modal-right {
  background-color: #fff;
  color: #333;
  position: relative;
  align-content: center;
  vertical-align: middle;
}

.close-btn {
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 2rem;
    color: black;
    cursor: pointer;
    user-select: none;
}

.desc {
    position: relative;
    align-content: right;
    background-color: #fff;
    color: #333;
}

#buy-btn {
    top: 50%;
    right: 25%;
    font-size: 1rem;
    background-color: green;
    color: white;
}

#preview-img {
    position: absolute;
    max-width: 90%;
    max-height: 90%;
    border-radius: 8px;
    align-content: center;
    vertical-align: middle;
}

#modal-img {
    max-width: 90%;
    max-height: 90%;
    box-shadow: 0 0 20px #fff;
    border-radius: 8px;
    align-content: center;
    vertical-align: middle;
}

.clothing-grid {
    display: flex;
    flex-wrap: wrap;    
}

.center {
    text-align: center;
    margin: 20px 0;
}

h1 {
    font-family: Helvetica, sans-serif;
    font-size: 2.5rem;
    color: #333;
}
h2 {
    font-family: Helvetica, sans-serif;
    font-size: 2rem;
    color: #666;
}

body {
    font-family: Arial, sans-serif;
    padding: 20px;
}

header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.header-left {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.header-center {
    text-align: center;
    flex: 1;
}

.button {
    padding: 10px 20px;
    font-size: 1rem;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    text-decoration: none;
}

.button-left {
    background-color: #1377e2; /* Blue */
}

</style>
<body>
    {% load static %}
    <!-- Header -->
    <header>
        <div class="header-left">
            <a href="{% url 'home' %}" class="button button-left">Back to Home</a>
            <a href="{% url 'dress_page' %}" class="button button-left">Dress Pet</a>        </div>
        <div class="header-center">
            <h1>Welcome to the Shop!</h1>
            {% if user %}
                <h2>Your coins: {{ user.coins }}</h2>
            {% else %}
                <h2>Hello Stranger</h2>
            {% endif %}
        </div>
    </header>

    <!-- Hats Section -->
    <h2 class="section-title">Hats</h2>
    <div class="clothing-grid">
        {% for hat in hats_unowned %}
        <div class="clothing-item" onclick="showModal('{% static hat.image_path %}?v={{ timestamp }}', '{{ hat.clothing_id }}', 'Hat', '{{ hat.price }}')">
            <img src="{% static hat.image_path %}?v={{ timestamp }}" alt="Hat" style="max-width: 200px; max-height: 200px;">
            <p>Price: {{ hat.price }} coins</p>
        </div>
        {% empty %}
            <p>You own all available hats!</p>
        {% endfor %}
    </div>

<!-- Shirts Sections -->
    <h2>Shirts</h2>
    <div class="clothing-grid">
        {% for shirt in shirts_unowned %}
        <div class="clothing-item" onclick="showModal('{% static shirt.image_path %}?v={{ timestamp }}', '{{ shirt.clothing_id }}', 'Shirt', '{{ shirt.price }}')">
            <img src="{% static shirt.image_path %}?v={{ timestamp }}" alt="Shirt" style="max-width: 200px; max-height: 200px;">
            <p>Price: {{ shirt.price }} coins</p>
        </div>
        {% empty %}
            <p>You own all available shirts!</p>
        {% endfor %}
    </div>

<!-- Shoes Section -->
    <h2>Shoes</h2>
    <div class="clothing-grid">
        {% for shoe in shoes_unowned %}
        <div class="clothing-item" onclick="showModal('{% static shoe.image_path %}?v={{ timestamp }}', '{{ shoe.clothing_id }}', 'Shoe', '{{ shoe.price }}')">
            <img src="{% static shoe.image_path %}?v={{ timestamp }}" alt="Shoe" style="max-width: 200px; max-height: 200px;">
            <p>Price: {{ shoe.price }} coins</p>
        </div>
        {% empty %}
            <p>You own all available shoes!</p>
        {% endfor %}
    </div>

    <!-- The Pop Up Image -->
    <div id="image-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content">
            <div class="modal-left">
                {% if user %}
                    <img id="preview-img" src="{% static pet.image_path %}?v={{ timestamp }}" alt="Pet">
                {% endif %}
                <img id="modal-img" src="" alt="Enlarged Image">
            </div>
            <div class="modal-right">
                <span class="close-btn" onclick="hideModal()">&times;</span>
                <div class="desc">
                    <h2 id="modal-item-title">Item</h2>
                    <p id="modal-item-price">Price: ðŸª™200</p>
                    <form method="post" action="{% url 'buy_clothing' %}">
                        {% csrf_token %}
                        <input type="hidden" id="modal-clothing-id" name="clothing_id" value="">
                        <button type="submit" class="button">Buy</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    // import clothing data TODO: check if account checking is needed

    // // check shirts owned
    // fetch('/app/data/clothing.json')
    // .then(response => response.json())
    // .then(imageUrls => {

    //     imageUrls.forEach(url => {
    //     const img = document.createElement('img');
    //     img.src = `/app/${url["image_path"]}`;
    //     img.alt = url["clothing_type"];
    //     let container = document.getElementById(`image-container-${img.alt.toLowerCase()}`);
    //     img.style.width = '500px';
    //     img.style.height = '500px';
    //     img.style.margin = '10px';
    //     img.style.objectFit = 'cover';

    //     // If image fails to load, replace with blank square (gray box)
    //     img.onerror = function () {
    //         img.src = '';
    //         img.style.backgroundColor = '#ccc'; // light gray
    //     };
    //     img.onclick = () => showModal(`/app/${url["image_path"]}`);
    //     container.appendChild(img);
    //     });
    // })
    // .catch(error => {
    //     console.error('Error loading images:', error);
    // });
        
     // Modal functionality
    function showModal(src, clothingId, title, price) {
        const modal = document.getElementById('image-modal');
        const modalImg = document.getElementById('modal-img');
        const clothingIdInput = document.getElementById('modal-clothing-id');
        const modalTitle = document.getElementById('modal-item-title');
        const modalPrice = document.getElementById('modal-item-price');

        modal.style.display = 'flex';
        modalImg.src = src;
        clothingIdInput.value = clothingId;
        modalTitle.textContent = title;
        modalPrice.textContent = `Price: ðŸª™${price}`;
        previewClothing();
        showBuyButton();
    }

    function hideModal() {
        document.getElementById('image-modal').style.display = 'none';
        hidePreview();
        hideBuyButton();
    }

    // Optional: Close when clicking outside image
    function closeModal(event) {
        if (event.target.id === 'image-modal') {
            hideModal();
        }
    }
    
    function showBuyButton() {
        const buybtn = document.getElementById('buy-btn');
        buybtn.style.display = 'block';
        //TODO: check if user has enough coins
    }

    function hideBuyButton() {
        document.getElementById('buy-btn').style.display = 'none';
    }

    function previewClothing() {
        // TODO: overlay clothing on pet img - need reference img
        const preview = document.getElementById('preview-img');
        preview.style.display = 'block';
    }

    function hidePreview() {
        document.getElementById('preview-img').style.display = 'none';
    }

    function buyItem() {
        console.log("Purchase successful!")
    }
</script>

